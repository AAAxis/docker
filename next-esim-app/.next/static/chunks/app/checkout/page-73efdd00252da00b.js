(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{424:(e,t,r)=>{"use strict";r.d(t,{configService:()=>i});var a=r(9708),s=r(686),n=r(5704);class o{async getStripeMode(){try{let e=(0,a.doc)(s.db,"config","stripe"),t=await (0,a.getDoc)(e);if(t.exists()){let e=t.data();if(e.mode)return console.log("✅ Stripe mode loaded from Firestore:",e.mode),e.mode}let r=localStorage.getItem("esim_stripe_mode");if(r)return console.log("✅ Stripe mode loaded from localStorage:",r),r;return console.log("⚠️ No Stripe mode found, defaulting to test"),"test"}catch(e){return console.error("❌ Error loading Stripe mode:",e),localStorage.getItem("esim_stripe_mode")||"test"}}async getDataPlansEnvironment(){try{let e=(0,a.doc)(s.db,"config","environment"),t=await (0,a.getDoc)(e);if(t.exists()){let e=t.data();if(e.mode)return console.log("✅ DataPlans environment loaded from Firestore:",e.mode),e.mode}let r=localStorage.getItem("esim_environment");if(r)return console.log("✅ DataPlans environment loaded from localStorage:",r),r;return console.log("⚠️ No DataPlans environment found, defaulting to test"),"test"}catch(e){return console.error("❌ Error loading DataPlans environment:",e),localStorage.getItem("esim_environment")||"test"}}getStripePublishableKey(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"test";return"live"===e||"production"===e?n.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY_LIVE||"pk_test_51LXRaMDoWGog1gVB88ytV8ZVHdl4aZqKA6fImyAKhFPLrxFESftTeqLQIquHH18X2TDQUdbvMLDCRRfgPzeaa0cm00sUIflyfu":n.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY_TEST||"pk_test_51LXRaMDoWGog1gVB88ytV8ZVHdl4aZqKA6fImyAKhFPLrxFESftTeqLQIquHH18X2TDQUdbvMLDCRRfgPzeaa0cm00sUIflyfu"}getStripeSecretKey(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"test";return"live"===e||"production"===e?n.env.STRIPE_SECRET_KEY_LIVE||n.env.STRIPE_SECRET_KEY:n.env.STRIPE_SECRET_KEY_TEST||n.env.STRIPE_SECRET_KEY}clearCache(){this.cache.clear()}constructor(){this.cache=new Map,this.cacheTimeout=3e5}}let i=new o},686:(e,t,r)=>{"use strict";r.d(t,{Cn:()=>u,db:()=>m,j2:()=>d});var a=r(2078),s=r(1328),n=r(9708),o=r(9996),i=r(6849),l=r(4663);let c=(0,a.Wp)({apiKey:"AIzaSyAl456JTQntXJItbXSv8hx1oQ9KW4BGci4",authDomain:"esim-f0e3e.firebaseapp.com",projectId:"esim-f0e3e",storageBucket:"esim-f0e3e.firebasestorage.app",messagingSenderId:"482450515497",appId:"1:482450515497:web:08533fb9536c8e6aa39e38",measurementId:"G-T0YBW024Z8"}),d=(0,s.xI)(c),m=(0,n.aU)(c);(0,o.c7)(c);let u=(0,i.Uz)(c);(0,l.TT)().then(e=>{e?((0,l.P5)(c),console.log("✅ Firebase Analytics initialized")):console.log("⚠️ Firebase Analytics not supported in this environment")}).catch(e=>{console.log("⚠️ Firebase Analytics initialization failed:",e)})},2467:(e,t,r)=>{"use strict";r.d(t,{default:()=>R});var a=r(5155),s=r(2115),n=r(63),o=r(8206),i=r(4511),l=r(6849),c=r(686),d=r(5704);let m=(0,l.Qg)(c.Cn,"createPaymentIntent"),u=(0,l.Qg)(c.Cn,"processWalletPayment"),y=(0,l.Qg)(c.Cn,"confirmPayment"),g=d.env.REACT_APP_STRIPE_PUBLISHABLE_KEY?(0,i.c)(d.env.REACT_APP_STRIPE_PUBLISHABLE_KEY):Promise.resolve(null),h={async createPaymentIntent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"usd",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return(await m({amount:e,currency:t,metadata:r})).data}catch(e){throw console.error("Error creating payment intent:",e),e}},async processWalletPayment(e,t){try{return(await u({orderId:e,amount:t})).data}catch(e){throw console.error("Error processing wallet payment:",e),e}},async confirmPayment(e){try{return(await y({paymentIntentId:e})).data}catch(e){throw console.error("Error confirming payment:",e),e}},getStripe:async()=>await g,async createCheckoutSession(e){try{if(!await this.getStripe())throw Error("Stripe failed to load");return(await m({amount:e.amount,currency:e.currency||"usd",metadata:{orderId:e.orderId,planId:e.planId,customerEmail:e.customerEmail}})).data}catch(e){throw console.error("Error creating checkout session:",e),e}}},x=(0,l.Qg)(c.Cn,"createOrder"),p=(0,l.Qg)(c.Cn,"getEsimQrCode"),f=(0,l.Qg)(c.Cn,"checkEsimCapacity"),b=(0,l.Qg)(c.Cn,"syncCountriesFromApi"),w=(0,l.Qg)(c.Cn,"syncRegionsFromApi"),E=(0,l.Qg)(c.Cn,"syncPlansFromApi"),S=(0,l.Qg)(c.Cn,"syncAllDataFromApi"),v={async createOrder(e){try{return(await x(e)).data}catch(e){throw console.error("Error creating eSIM order:",e),e}},async getEsimQrCode(e){try{return(await p({orderId:e})).data}catch(e){throw console.error("Error getting eSIM QR code:",e),e}},async checkEsimCapacity(e){try{return(await f({planId:e})).data}catch(e){throw console.error("Error checking eSIM capacity:",e),e}},async syncCountriesFromApi(){try{return(await b()).data}catch(e){throw console.error("Error syncing countries:",e),e}},async syncRegionsFromApi(){try{return(await w()).data}catch(e){throw console.error("Error syncing regions:",e),e}},async syncPlansFromApi(){try{return(await E()).data}catch(e){throw console.error("Error syncing plans:",e),e}},async syncAllDataFromApi(){try{return(await S()).data}catch(e){throw console.error("Error syncing all data:",e),e}}};var P=r(424),j=r(4486),N=r(6132),I=r(5299),_=r(8519),C=r(2663);let A={style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}},T=e=>{let{plan:t,onSuccess:r,onCancel:n}=e,i=(0,o.useStripe)(),l=(0,o.useElements)(),[c,d]=(0,s.useState)(!1),[m,u]=(0,s.useState)(null),[y,g]=(0,s.useState)(null),[x,p]=(0,s.useState)("test"),[f,b]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=async()=>{try{d(!0);let e=await h.createPaymentIntent(100*t.price,"usd",{planId:t.id,planName:t.name,customerEmail:"customer@example.com",stripeMode:x});g(e)}catch(e){u("Failed to initialize payment"),C.Ay.error("Payment initialization failed")}finally{d(!1)}};(async()=>{try{b(!0);let r=await P.configService.getStripeMode();if(p(r),console.log("✅ Stripe mode loaded:",r),!P.configService.getStripePublishableKey(r)){u("Stripe is not configured for this mode"),C.Ay.error("Payment system not configured");return}t&&await e()}catch(e){console.error("❌ Error loading Stripe config:",e),u("Failed to load payment configuration"),C.Ay.error("Payment configuration failed")}finally{b(!1)}})()},[t,x]);let w=async e=>{if(e.preventDefault(),i&&l){d(!0),u(null);try{let e={planId:t.id,customerEmail:"customer@example.com",amount:t.price,currency:"usd"},a=await v.createOrder(e),{error:s,paymentIntent:n}=await i.confirmCardPayment(y.client_secret,{payment_method:{card:l.getElement(o.CardElement),billing_details:{email:"customer@example.com"}}});if(s)u(s.message),C.Ay.error(s.message);else if("succeeded"===n.status){let e=await v.getEsimQrCode(a.id);C.Ay.success("Payment successful! Your eSIM is ready."),r({order:a,qrCode:e,paymentIntent:n})}}catch(e){u("Payment failed. Please try again."),C.Ay.error("Payment failed. Please try again.")}finally{d(!1)}}};return t?f?(0,a.jsx)("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-lg p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(I.A,{className:"w-12 h-12 text-blue-500 mx-auto mb-4 animate-spin"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Loading Payment Configuration"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please wait while we set up your payment..."})]})}):m&&m.includes("not configured")?(0,a.jsx)("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-lg p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(N.A,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Payment Configuration Required"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Stripe payment processing is not configured. Please contact support."}),(0,a.jsx)("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Go Back"})]})}):(0,a.jsxs)(j.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"max-w-md mx-auto bg-white rounded-xl shadow-lg p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Checkout"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Complete your eSIM purchase"}),(0,a.jsxs)("div",{className:"mt-3 inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[(0,a.jsx)("span",{className:"mr-2",children:"test"===x?"\uD83E\uDDEA":"\uD83D\uDE80"}),"test"===x?"Test Mode":"Live Mode","test"===x&&(0,a.jsx)("span",{className:"ml-2 text-yellow-600",children:"(No real charges)"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:t.name}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,a.jsxs)("span",{children:[t.data," ",t.dataUnit]}),(0,a.jsxs)("span",{children:[t.validity," days"]})]}),(0,a.jsx)("div",{className:"text-right mt-2",children:(0,a.jsxs)("span",{className:"text-2xl font-bold text-gray-900",children:["$",Math.round(t.price)]})})]}),(0,a.jsxs)("form",{onSubmit:w,children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Card Details"}),(0,a.jsx)("div",{className:"border border-gray-300 rounded-lg p-3",children:(0,a.jsx)(o.CardElement,{options:A})})]}),m&&(0,a.jsxs)(j.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center p-3 mb-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsx)(N.A,{className:"w-5 h-5 text-red-500 mr-2"}),(0,a.jsx)("span",{className:"text-red-700 text-sm",children:m})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:n,disabled:c,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:!i||c,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50 flex items-center justify-center",children:c?(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.A,{className:"w-4 h-4 mr-2"}),"Pay $",Math.round(t.price)]})})]})]}),c&&(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Processing your payment..."})})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(N.A,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"No plan selected for checkout"})]})},D=()=>(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})});function R(){let e=(0,n.useSearchParams)(),[t,l]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0),[m,u]=(0,s.useState)(null),[y,g]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{try{let t=e.get("plan"),a=e.get("type");if(!t){u("No plan selected"),d(!1);return}let{collection:s,doc:n,getDoc:o}=await Promise.resolve().then(r.bind(r,9708)),{db:i}=await Promise.resolve().then(r.bind(r,686)),c=await o(n(i,"plans",t));if(c.exists()){let e=c.data();l({id:c.id,...e,type:a||"country"})}else u("Plan not found")}catch(e){console.error("Error loading plan:",e),u("Failed to load plan")}finally{d(!1)}})()},[e]),(0,s.useEffect)(()=>{(async()=>{try{let{configService:e}=await Promise.resolve().then(r.bind(r,424)),t=await e.getStripeMode(),a=e.getStripePublishableKey(t);if(a){let e=await (0,i.c)(a);g(e)}else console.error("No Stripe publishable key found")}catch(e){console.error("Error loading Stripe config:",e)}})()},[]),c)?(0,a.jsx)(D,{}):m||!t?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-lg p-6 text-center",children:[(0,a.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\uD83D\uDCF1"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Plan Selected"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Please select a plan from the plans page to continue with checkout."}),(0,a.jsx)("button",{onClick:()=>window.location.href="/plans",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Browse Plans"})]})}):y?(0,a.jsx)(o.Elements,{stripe:y,children:(0,a.jsx)(T,{plan:t})}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-lg p-6 text-center",children:[(0,a.jsx)("div",{className:"text-blue-500 text-6xl mb-4",children:"\uD83D\uDCB3"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Payment System"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Please wait while we set up your payment..."}),(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"})]})})}},8691:(e,t,r)=>{Promise.resolve().then(r.bind(r,2467))}},e=>{e.O(0,[135,210,584,416,663,116,441,255,358],()=>e(e.s=8691)),_N_E=e.O()}]);